<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MindEase - Welcome</title>

    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

<body>
  <header>
    <div class="logo">
      <img src="../../assets/icons/logo.png" alt="Brain Icon">
      <span>MindEase</span>
    </div>
    <nav>
      <ul>
        <li><a href="../index.html">Home</a></li>
        <li><a href="./mood.html">Mood Tracker</a></li>
        <li><a href="./journal.html">Journal</a></li>
        <li><a href="./quotes.html">Quotes</a></li>
        <li><a href="./calm_corner.html">Calm Corner</a></li>
        <li><a href="./login.html">Login</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <section class="section-login">
      <div class="container">
        <div class="image-section">
          <img src="../../assets/images/login-illustration.png" alt="Relax illustration" />
        </div>

        <div class="login-card">
          <div class="login-header">
            <h1>Welcome Back</h1>
            <p class="subtitle">Log in to continue your wellness journey</p>
          </div>

          <!-- MESSAGE CONTAINER FOR FEEDBACK -->
          <div id="messageContainer"></div>

          <form id="loginForm">
            <label for="email">Email</label>
            <input type="email" id="email" placeholder="your@email.com" name="email" required />

            <label for="password">Password</label>
            <input type="password" id="password" placeholder="••••••••" name="password" required />

            <button type="submit">Login</button>

            <a href="#" class="forgot">Forgot Password?</a>

            <p class="signup-text">
              Don't have an account?
              <a href="../pages/register.html" class="signup-link">Create Account</a>
            </p>
          </form>
        </div>
      </div>
    </section>
  </main>

        <!-- Forgot Password -->
        <div class="auth-card" id="forgotPasswordView" style="display: none">
          <h1>Forgot Password</h1>
          <p class="subtitle">Enter your email to receive a reset link</p>
          <form id="forgotPasswordForm">
            <label for="forgot-email">Email</label>
            <input
              type="email"
              id="forgot-email"
              placeholder="your@email.com"
              required
            />
            <button type="submit">Send Reset Link</button>
            <p class="bottom-text">
              Remembered your password?
              <a href="#" class="toggle-link" id="showLoginFromForgotLink"
                >Log In</a
              >
            </p>
          </form>
        </div>
      </div>
    </main>

  <script>
    // Function to display messages to user
    function showMessage(message, type) {
      const messageContainer = document.getElementById('messageContainer');
      messageContainer.innerHTML = `<div class="msg-box ${type}">${message}</div>`;
      
      // Auto-remove message after 5 seconds
      setTimeout(() => {
        if (messageContainer.innerHTML.includes(message)) {
          messageContainer.innerHTML = '';
        }
      }, 5000);
    }

    // Handle form submission
    document.getElementById("loginForm").addEventListener("submit", function(e) {
      e.preventDefault();

      const formData = new FormData(this);

      // Show loading state
      const submitBtn = this.querySelector('button[type="submit"]');
      const originalText = submitBtn.textContent;
      submitBtn.textContent = "Logging in...";
      submitBtn.disabled = true;

      // IMPORTANT: Check if this path is correct for your setup
      fetch("../../mindease-backend/src/config/login.php", {
        method: "POST",
        body: formData
      })
      .then(res => {
        if (!res.ok) {
          throw new Error('Network response was not ok');
        }
        return res.text();
      })
      .then(data => {
        console.log("Server Response:", data); // For debugging
        
        if (data.trim() === "success") {
          showMessage("Login Successful! Redirecting...", "success");
          setTimeout(() => {
            window.location.href = "../index.html";
          }, 1500);
        } else if (data.trim() === "invalid") {
          showMessage("Incorrect password. Please try again.", "error");
        } else if (data.trim() === "notfound") {
          showMessage("No account found with this email.", "error");
        } else {
          // If we get an unexpected response
          showMessage("Login error: " + data, "error");
        }
      })
      .catch(error => {
        console.error('Error:', error);
        showMessage("Login failed. Please check your connection and try again.", "error");
      })
      .finally(() => {
        // Reset button state
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
      });
    });
  </script>
</body>
</html>
