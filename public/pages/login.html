<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MindEase - Login</title>
  <link href="../css/login.css" rel="stylesheet">
  <link rel="stylesheet" href="../css/login.css">
</head>

<body>
  <header>
    <div class="logo">
      <img src="../../assets/icons/logo.png" alt="Brain Icon">
      <span>MindEase</span>
    </div>
    <nav>
      <ul class="sidebar">
        <li onclick=hideSidebar()><a href="#"><img src="../../assets/icons/close_icon.png" alt="close_icon"></a></li>
        <li><a href="../index.html">Home</a></li>
        <li><a href="./mood.html">Mood Tracker</a></li>
        <li><a href="./journal.html">Journal</a></li>
        <li><a href="./quotes.html">Quotes</a></li>
        <li><a href="./calm_corner.html">Calm Corner</a></li>
        <li><a class="nav-active" href="./login.html">Login</a></li>
      </ul>
      <ul>
        <li class="hideOnMobile"><a href="../index.html">Home</a></li>
        <li class="hideOnMobile"><a href="./mood.html">Mood Tracker</a></li>
        <li class="hideOnMobile"><a href="./journal.html">Journal</a></li>
        <li class="hideOnMobile"><a href="./quotes.html">Quotes</a></li>
        <li class="hideOnMobile"><a href="./calm_corner.html">Calm Corner</a></li>
        <li class="hideOnMobile"><a class="nav-active" href="./login.html">Login</a></li>
        <li class="menu-button" onclick=showSidebar()><a href="#"><img src="../../assets/icons/menu_icon.svg"
              alt="menu_icon"></a></li>
      </ul>
    </nav>
  </header>

  <main>
    <section class="section-login">
      <div class="container">
        <div class="image-section">
          <img src="/MindEase/assets/loginpage/pexels-olly-3771836.jpg" alt="Relax illustration" />
        </div>

        <div class="login-card">
          <div class="login-header">
            <h1>Welcome Back</h1>
            <p class="subtitle">Log in to continue your wellness journey</p>
          </div>

          <!-- MESSAGE CONTAINER FOR FEEDBACK -->
          <div id="messageContainer"></div>

          <form id="loginForm" method="post">
            <label for="email">Email</label>
            <input type="email" id="email" placeholder="your@email.com" name="email" required />

            <label for="password">Password</label>
            <input type="password" id="password" placeholder="••••••••" name="password" required />

            <button type="submit">Login</button>

            <a href="../pages/forget_password.html" class="forgot">Forgot Password?</a>

            <p class="signup-text">
              Don't have an account?
              <a href="../pages/register.html" class="signup-link">Create Account</a>
            </p>
          </form>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <p>
      <a href="./privacy.html">Privacy Policy</a> |
      <a href="./contact_us.html">Contact</a> |
      <a href="./help.html">Help</a> |
      <a href="./about_us.html">About Us</a>
    </p>
    <p>© 2025 MindEase. All Rights Reserved.</p>
  </footer>

  <!-- Load config first -->
  <script src="../js/config.js"></script>

  <script>
    function showSidebar() {
      const sidebar = document.querySelector('.sidebar')
      sidebar.style.display = 'flex'
    }

    function hideSidebar() {
      const sidebar = document.querySelector('.sidebar')
      sidebar.style.display = 'none'
    }
    // Function to display messages to user
    function showMessage(message, type) {
      const messageContainer = document.getElementById('messageContainer');
      messageContainer.innerHTML = `<div class="msg-box ${type}">${message}</div>`;

      // Auto-remove message after 5 seconds
      setTimeout(() => {
        if (messageContainer.innerHTML.includes(message)) {
          messageContainer.innerHTML = '';
        }
      }, 5000);
    }

    // Handle form submission
    document.getElementById("loginForm").addEventListener("submit", function (e) {
      e.preventDefault();

      const formData = new FormData(this);

      // Show loading state
      const submitBtn = this.querySelector('button[type="submit"]');
      const originalText = submitBtn.textContent;
      submitBtn.textContent = "Logging in...";
      submitBtn.disabled = true;

      // Use CONFIG for dynamic URL
      fetch(CONFIG.getApiEndpoint("../../backend/auth/login.php"), {
        method: "POST",
        body: formData
      })
        .then(res => {
          if (!res.ok) {
            throw new Error('Network response was not ok');
          }
          return res.text();
        })
        .then(data => {
          console.log("Server Response:", data); // For debugging

          if (data.trim() === "success") {
            showMessage("Login Successful! Redirecting...", "success");
            setTimeout(() => {
              window.location.href = "../index.html";
            }, 1500);
          } else if (data.trim() === "invalid") {
            showMessage("Incorrect password. Please try again.", "error");
          } else if (data.trim() === "notfound") {
            showMessage("No account found with this email.", "error");
          } else {
            // If we get an unexpected response
            showMessage("Login error: " + data, "error");
          }
        })
        .catch(error => {
          console.error('Error:', error);
          showMessage("Login failed. Please check your connection and try again.", "error");
        })
        .finally(() => {
          // Reset button state
          submitBtn.textContent = originalText;
          submitBtn.disabled = false;
        });
    });
  </script>
</body>

</html>